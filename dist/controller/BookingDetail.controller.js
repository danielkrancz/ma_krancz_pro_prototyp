sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/core/routing/History","sap/m/MessageBox","sap/ui/export/Spreadsheet","sap/ui/export/library","sap/m/p13n/Engine","sap/m/p13n/SelectionController","sap/m/p13n/SortController","sap/m/p13n/GroupController","sap/m/p13n/MetadataHelper","sap/m/table/ColumnWidthController","sap/ui/core/library"],(e,t,n,r,o,a,i,s,l,p,u,g)=>{"use strict";var c=o.EdmType;return e.extend("at.hb.makrancz.procodeapp.controller.BookingDetail",{onInit:function(){this.getOwnerComponent().getRouter().getRoute("BookingDetail").attachPatternMatched(this._onPatternMatched,this);this._registerForP13n()},_onPatternMatched:function(e){this.sTravelID=e.getParameters().arguments.TravelID;this.sBookingID=e.getParameters().arguments.BookingID;this.path=`/Booking(TravelID='${this.sTravelID}',BookingID='${this.sBookingID}')`;this.getView().bindElement(this.path)},onEdit:function(){this.getOwnerComponent().getRouter().navTo("BookingEdit",{TravelID:this.sTravelID,BookingID:this.sBookingID})},onSearchChanged:function(e){let t=this.byId("bookingSupplementTable"),n=t.getBindingInfo("items");if(!n.parameters){n.parameters={}}if(!n.parameters.custom){n.parameters.custom={}}n.parameters.custom.search=e.getParameters().value;t.bindItems(n)},onNavBack(){const e=t.getInstance();const n=e.getPreviousHash();if(n!==undefined){window.history.go(-1)}else{const e=this.getOwnerComponent().getRouter();e.navTo("RouteMain",{},true)}},onExport:function(){var e,t,n,o,a;if(!this.oTable){this.oTable=this.byId("bookingSupplementTable")}a=this.oTable;t=a.getBinding("items");e=this.createColumnConfig();n={workbook:{columns:e,hierarchyLevel:"Level"},dataSource:t,fileName:"BookingSupplements.xlsx",worker:false};o=new r(n);o.build().finally(function(){o.destroy()})},createColumnConfig:function(){var e=[];e.push({label:"Booking Supplement ID",property:"BookingSupplementID",type:c.String});e.push({label:"Supplement ID",property:["SupplementID","SupplementDescription"],type:c.String,template:"{1} ({0})"});e.push({label:"Price",type:c.Number,property:"Price",scale:2});return e},_registerForP13n:function(){var e=this.byId("bookingSupplementTable");this.oMetadataHelper=new p([{key:"bookingsupplementid",label:"Booking Supplement ID",path:"BookingSupplementID",cell:"{BookingSupplementID}"},{key:"SupplementID",label:"Supplement ID",path:"SupplementID",cell:"{SupplementDescription} ({SupplementID})"},{key:"price",label:"Price",path:"Price"}]);a.getInstance().register(e,{helper:this.oMetadataHelper,controller:{Columns:new i({targetAggregation:"columns",control:e}),Sorter:new s({control:e}),Groups:new l({control:e}),ColumnWidth:new u({control:e})}});a.getInstance().attachStateChange(this.handleStateChange.bind(this))},openPersoDialog:function(e){var t=this.byId("bookingSupplementTable");a.getInstance().show(t,["Columns","Sorter","Groups"],{contentHeight:"35rem",contentWidth:"32rem",source:e.getSource()})},_getKey:function(e){return this.getView().getLocalId(e.getId())},handleStateChange:function(e){var t=this.byId("bookingSupplementTable");var n=e.getParameter("state");if(!n){return}var r=[];n.Groups.forEach(function(e){r.push(new Sorter(this.oMetadataHelper.getProperty(e.key).path,false,true))}.bind(this));n.Sorter.forEach(function(e){var t=r.find(function(t){return t.sPath===this.oMetadataHelper.getProperty(e.key).path}.bind(this));if(t){t.bDescending=!!e.descending}else{r.push(new Sorter(this.oMetadataHelper.getProperty(e.key).path,e.descending))}}.bind(this));t.getColumns().forEach(function(e,t){e.setVisible(false);e.setWidth(n.ColumnWidth[this._getKey(e)]);e.setSortIndicator(g.SortOrder.None);e.data("grouped",false)}.bind(this));n.Sorter.forEach(function(e){var t=this.byId(e.key);if(e.sorted!==false){t.setSortIndicator(e.descending?g.SortOrder.Descending:g.SortOrder.Ascending)}}.bind(this));n.Groups.forEach(function(e){var t=this.byId(e.key);t.data("grouped",true)}.bind(this));n.Columns.forEach(function(e,n){var r=this.byId(e.key);r.setVisible(true);t.removeColumn(r);t.insertColumn(r,n)}.bind(this));var o=n.Columns.map(function(e){return new Text({text:this.oMetadataHelper.getProperty(e.key).cell})}.bind(this));t.bindItems({templateShareable:false,path:"to_BookSupplement",sorter:r,template:new ColumnListItem({cells:o})})},beforeOpenColumnMenu:function(e){var t=this.byId("menu");var n=e.getParameter("openBy");var r=t.getQuickActions()[0].getItems()[0];var o=t.getQuickActions()[1].getItems()[0];r.setKey(this._getKey(n));r.setLabel(n.getHeader().getText());r.setSortOrder(n.getSortIndicator());o.setKey(this._getKey(n));o.setLabel(n.getHeader().getText());o.setGrouped(n.data("grouped"))},onColumnHeaderItemPress:function(e){var t=this.byId("bookingSupplementTable");var n=e.getSource();var r="Columns";if(n.getIcon().indexOf("group")>=0){r="Groups"}else if(n.getIcon().indexOf("sort")>=0){r="Sorter"}a.getInstance().show(t,[r],{contentHeight:"35rem",contentWidth:"32rem",source:t})},onSort:function(e){var t=e.getParameter("item");var n=this.byId("bookingSupplementTable");var r=t.getKey();var o=t.getSortOrder();a.getInstance().retrieveState(n).then(function(e){e.Sorter.forEach(function(e){e.sorted=false});if(o!==g.SortOrder.None){e.Sorter.push({key:r,descending:o===g.SortOrder.Descending})}a.getInstance().applyState(n,e)})},onGroup:function(e){var t=e.getParameter("item");var n=this.byId("bookingSupplementTable");var r=t.getKey();a.getInstance().retrieveState(n).then(function(e){e.Groups.forEach(function(e){e.grouped=false});if(t.getGrouped()){e.Groups.push({key:r})}a.getInstance().applyState(n,e)})},onColumnMove:function(e){var t=e.getParameter("draggedControl");var n=e.getParameter("droppedControl");if(t===n){return}var r=this.byId("bookingSupplementTable");var o=e.getParameter("dropPosition");var i=r.indexOfColumn(t);var s=r.indexOfColumn(n);var l=s+(o=="Before"?0:1)+(i<s?-1:0);var p=this._getKey(t);a.getInstance().retrieveState(r).then(function(e){var t=e.Columns.find(function(e){return e.key===p})||{key:p};t.position=l;a.getInstance().applyState(r,{Columns:[t]})})},onColumnResize:function(e){var t=e.getParameter("column");var n=e.getParameter("width");var r=this.byId("bookingSupplementTable");var o={};o[this._getKey(t)]=n;a.getInstance().applyState(r,{ColumnWidth:o})}})});
//# sourceMappingURL=BookingDetail.controller.js.map