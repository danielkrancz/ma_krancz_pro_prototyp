sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/core/routing/History","sap/m/MessageBox","sap/ui/export/Spreadsheet","sap/ui/export/library","sap/m/p13n/Engine","sap/m/p13n/SelectionController","sap/m/p13n/SortController","sap/m/p13n/GroupController","sap/m/p13n/MetadataHelper","sap/m/table/ColumnWidthController","sap/ui/core/library"],(e,t,n,o,r,a,i,s,l,g,u,c)=>{"use strict";var h=r.EdmType;return e.extend("at.hb.makrancz.procodeapp.controller.Detail",{onInit:function(){this.getOwnerComponent().getRouter().getRoute("Detail").attachPatternMatched(this._onPatternMatched,this);this._registerForP13n()},_onPatternMatched:function(e){this.sTravelID=e.getParameters().arguments.TravelID;this.path=`/Travel('${this.sTravelID}')`;this.getView().bindElement(this.path)},onEdit:function(){this.getOwnerComponent().getRouter().navTo("Edit",{TravelID:this.sTravelID})},onSearchChanged:function(e){let t=this.byId("bookingTable"),n=t.getBindingInfo("items");if(!n.parameters){n.parameters={}}if(!n.parameters.custom){n.parameters.custom={}}n.parameters.custom.search=e.getParameters().value;t.bindItems(n)},onNavBack(){const e=t.getInstance();const n=e.getPreviousHash();if(n!==undefined){window.history.go(-1)}else{const e=this.getOwnerComponent().getRouter();e.navTo("RouteMain",{},true)}},onCreateBooking:function(e){this.getOwnerComponent().getRouter().navTo("BookingCreate",{TravelID:this.sTravelID})},onDelete:function(){n.warning(`Delete object ${this.getView().getElementBinding().getBoundContext().getObject().TravelID}?`,{actions:["Delete","Cancel"],emphasizedAction:"Delete",initialFocus:"Cancel",onClose:e=>{if(e==="Delete"){this.getView().getModel().remove(this.getView().getElementBinding().getPath(),{success:()=>{this.onNavBack()}})}}})},onExport:function(){var e,t,n,r,a;if(!this.oTable){this.oTable=this.byId("bookingTable")}a=this.oTable;t=a.getBinding("items");e=this.createColumnConfig();n={workbook:{columns:e,hierarchyLevel:"Level"},dataSource:t,fileName:"Bookings.xlsx",worker:false};r=new o(n);r.build().finally(function(){r.destroy()})},createColumnConfig:function(){var e=[];e.push({label:"Booking Number",property:"BookingID",type:h.String});e.push({label:"Booking Date",property:"BookingDate",type:h.Date});e.push({label:"Customer ID",property:["CustomerID","CustomerName"],type:h.String,template:"{1} ({0})"});e.push({label:"Airline ID",property:["CarrierID","CarrierName"],type:h.String,template:"{1} ({0})"});e.push({label:"Flight",property:"ConnectionID",type:h.String});e.push({label:"Flight Date",property:"FlightDate",type:h.Date});e.push({label:"Flight Price",type:h.Number,property:"FlightPrice",scale:2});e.push({label:"Booking Status",property:"BookingStatusText",type:h.String});return e},_registerForP13n:function(){var e=this.byId("bookingTable");this.oMetadataHelper=new g([{key:"bookingid",label:"Booking Number",path:"BookingID",cell:"{TravelID}"},{key:"bookingdate",label:"Booking Date",path:"BookingDate",cell:"{path: 'BookingDate', type: 'sap.ui.model.odata.type.Date'}"},{key:"customerid",label:"Customer ID",path:"CustomerID",cell:"{CustomerName} ({CustomerID})"},{key:"carrierid",label:"Airline ID",path:"CarrierID",cell:"{CarrierName} ({CarrierID})"},{key:"connectionid",label:"Flight",path:"ConnectionID",cell:"{ConnectionID}"},{key:"flightdate",label:"Flight Date",path:"FlightDate",cell:"{ path: 'FlightDate', type: 'sap.ui.model.odata.type.Date' }"},{key:"flightprice",label:"Flight Price",path:"FlightPrice"},{key:"status",label:"Booking Status",path:"BookingStatusText",cell:"{BookingStatusText}"}]);a.getInstance().register(e,{helper:this.oMetadataHelper,controller:{Columns:new i({targetAggregation:"columns",control:e}),Sorter:new s({control:e}),Groups:new l({control:e}),ColumnWidth:new u({control:e})}});a.getInstance().attachStateChange(this.handleStateChange.bind(this))},openPersoDialog:function(e){var t=this.byId("bookingTable");a.getInstance().show(t,["Columns","Sorter","Groups"],{contentHeight:"35rem",contentWidth:"32rem",source:e.getSource()})},_getKey:function(e){return this.getView().getLocalId(e.getId())},handleStateChange:function(e){var t=this.byId("bookingTable");var n=e.getParameter("state");if(!n){return}var o=[];n.Groups.forEach(function(e){o.push(new Sorter(this.oMetadataHelper.getProperty(e.key).path,false,true))}.bind(this));n.Sorter.forEach(function(e){var t=o.find(function(t){return t.sPath===this.oMetadataHelper.getProperty(e.key).path}.bind(this));if(t){t.bDescending=!!e.descending}else{o.push(new Sorter(this.oMetadataHelper.getProperty(e.key).path,e.descending))}}.bind(this));t.getColumns().forEach(function(e,t){e.setVisible(false);e.setWidth(n.ColumnWidth[this._getKey(e)]);e.setSortIndicator(c.SortOrder.None);e.data("grouped",false)}.bind(this));n.Sorter.forEach(function(e){var t=this.byId(e.key);if(e.sorted!==false){t.setSortIndicator(e.descending?c.SortOrder.Descending:c.SortOrder.Ascending)}}.bind(this));n.Groups.forEach(function(e){var t=this.byId(e.key);t.data("grouped",true)}.bind(this));n.Columns.forEach(function(e,n){var o=this.byId(e.key);o.setVisible(true);t.removeColumn(o);t.insertColumn(o,n)}.bind(this));var r=n.Columns.map(function(e){return new Text({text:this.oMetadataHelper.getProperty(e.key).cell})}.bind(this));t.bindItems({templateShareable:false,path:"to_Booking",sorter:o,template:new ColumnListItem({type:"Navigation",press:this.onListItemPressed.bind(this),cells:r})})},beforeOpenColumnMenu:function(e){var t=this.byId("menu");var n=e.getParameter("openBy");var o=t.getQuickActions()[0].getItems()[0];var r=t.getQuickActions()[1].getItems()[0];o.setKey(this._getKey(n));o.setLabel(n.getHeader().getText());o.setSortOrder(n.getSortIndicator());r.setKey(this._getKey(n));r.setLabel(n.getHeader().getText());r.setGrouped(n.data("grouped"))},onColumnHeaderItemPress:function(e){var t=this.byId("bookingTable");var n=e.getSource();var o="Columns";if(n.getIcon().indexOf("group")>=0){o="Groups"}else if(n.getIcon().indexOf("sort")>=0){o="Sorter"}a.getInstance().show(t,[o],{contentHeight:"35rem",contentWidth:"32rem",source:t})},onSort:function(e){var t=e.getParameter("item");var n=this.byId("bookingTable");var o=t.getKey();var r=t.getSortOrder();a.getInstance().retrieveState(n).then(function(e){e.Sorter.forEach(function(e){e.sorted=false});if(r!==c.SortOrder.None){e.Sorter.push({key:o,descending:r===c.SortOrder.Descending})}a.getInstance().applyState(n,e)})},onGroup:function(e){var t=e.getParameter("item");var n=this.byId("bookingTable");var o=t.getKey();a.getInstance().retrieveState(n).then(function(e){e.Groups.forEach(function(e){e.grouped=false});if(t.getGrouped()){e.Groups.push({key:o})}a.getInstance().applyState(n,e)})},onColumnMove:function(e){var t=e.getParameter("draggedControl");var n=e.getParameter("droppedControl");if(t===n){return}var o=this.byId("bookingTable");var r=e.getParameter("dropPosition");var i=o.indexOfColumn(t);var s=o.indexOfColumn(n);var l=s+(r=="Before"?0:1)+(i<s?-1:0);var g=this._getKey(t);a.getInstance().retrieveState(o).then(function(e){var t=e.Columns.find(function(e){return e.key===g})||{key:g};t.position=l;a.getInstance().applyState(o,{Columns:[t]})})},onColumnResize:function(e){var t=e.getParameter("column");var n=e.getParameter("width");var o=this.byId("bookingTable");var r={};r[this._getKey(t)]=n;a.getInstance().applyState(o,{ColumnWidth:r})},onListItemPressed:function(e){let t=e.getSource().getBindingContext().getObject();this.getOwnerComponent().getRouter().navTo("BookingDetail",{TravelID:t.TravelID,BookingID:t.BookingID})}})});
//# sourceMappingURL=Detail.controller.js.map